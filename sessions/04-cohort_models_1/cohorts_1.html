<!DOCTYPE html>
<html lang="en"><head>
<script src="cohorts_1_files/libs/clipboard/clipboard.min.js"></script>
<script src="cohorts_1_files/libs/quarto-html/tabby.min.js"></script>
<script src="cohorts_1_files/libs/quarto-html/popper.min.js"></script>
<script src="cohorts_1_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="cohorts_1_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cohorts_1_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="cohorts_1_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.2.269">

  <meta name="author" content="Alton Russell">
  <title>Cohort models 1</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="cohorts_1_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="cohorts_1_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="cohorts_1_files/libs/revealjs/dist/theme/quarto.css" id="theme">
  <link href="cohorts_1_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="cohorts_1_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="cohorts_1_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="cohorts_1_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-captioned.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-captioned) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-captioned.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-captioned .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-captioned .callout-caption  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-captioned.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-captioned.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-caption {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-caption {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-caption {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-captioned .callout-body > .callout-content > :last-child {
    margin-bottom: 0.5rem;
  }

  .callout.callout-captioned .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-captioned) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-caption {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-caption {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-caption {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-caption {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-caption {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Cohort models 1</h1>
  <p class="subtitle">EPIB 676 session 4, McGill University</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alton Russell 
</div>
</div>
</div>

  <p class="date">1/13/23</p>
</section>
<section id="today" class="slide level2">
<h2>Today</h2>
<ul>
<li><p><strong>Discrete-time cohort state-transition models</strong></p></li>
<li><p>Markov model solution</p></li>
<li><p>Time-varying transitions</p></li>
</ul>
</section>
<section id="packages" class="slide level2">
<h2>Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="fu">library</span>(heemod) <span class="co">#health economic markov models</span></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="fu">library</span>(expm) <span class="co">#for raising matrices to exponents with %^%</span></span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="fu">library</span>(tidyr) <span class="co">#for spread function for wide-to-long table formating</span></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="fu">library</span>(ggplot2) <span class="co">#plotting</span></span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="co">#use install.packages("Package") for any you don't have already</span></span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>()) <span class="co">#set ggplot theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cohort-state-transition-model" class="slide level2">
<h2><strong>Cohort state-transition model</strong></h2>
<ul>
<li><p>Dynamic mathematical model</p></li>
<li><p>A hypothetical cohort of individuals move between health states over time.</p></li>
<li><p>Classical example is the Markov model, where transition probabilities</p>
<ul>
<li><p>Are constant</p></li>
<li><p>Depend only on your current state</p></li>
</ul></li>
</ul>
</section>
<section id="when-to-use" class="slide level2">
<h2>When to use?</h2>
<ul>
<li><p>Decision problem has a dynamic component</p></li>
<li><p>Disease process can vary over time</p></li>
<li><p>Can be described with a reasonable number of health states</p></li>
</ul>
</section>
<section id="states" class="slide level2">
<h2><strong>States</strong></h2>
<blockquote>
<p>Healthy, acute infection, chronic infection, cirrhosis, untreated disease, in treatment, on wait list, lost to follow-up, dead…</p>
</blockquote>
<ul>
<li><p>Mutually exclusive and exhaustive</p></li>
<li><p>Individuals in the same state treated as identical</p>
<ul>
<li><p>same costs, same health outcomes</p></li>
<li><p>same probability of transitioning out (no matter how long they’ve been there)</p></li>
</ul></li>
</ul>
</section>
<section id="transitions-cycles-time-horizon" class="slide level2">
<h2>Transitions, cycles, time horizon</h2>
<ul>
<li><p>Only transition at end of a cycle</p></li>
<li><p>Cycle duration is design choice (second, day, month, quarter, year…)</p></li>
<li><p>Time horizon = cycle duration x number of cycles</p></li>
</ul>
</section>
<section id="transition-matrix" class="slide level2">
<h2>Transition matrix</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[
P=\\
\begin{bmatrix}
p_{s_1 \rightarrow s_1} &amp; p_{s_1 \rightarrow s_2} &amp; p_{s_1 \rightarrow s_3}\\
p_{s_2 \rightarrow s_1} &amp; p_{s_2 \rightarrow s_2} &amp; p_{s_2 \rightarrow s_3}\\
p_{s_3 \rightarrow s_1} &amp; p_{s_3 \rightarrow s_2} &amp; p_{s_3 \rightarrow s_3}
\end{bmatrix}
\]</span></p>
</div><div class="column" style="width:50%;">
<ul>
<li><p><span class="math inline">\(n_s \times n_s\)</span> matrix of transition probabilities</p>
<ul>
<li><span class="math inline">\(n_s\)</span> is number of states</li>
</ul></li>
<li><p>Rows correspond to “<strong>from</strong>” state (sum to 1)</p></li>
<li><p>Columns correspond to “<strong>to</strong>” states</p></li>
</ul>
</div>
</div>
</section>
<section id="transition-matrix-example" class="slide level2">
<h2>Transition matrix example</h2>
<div class="columns">
<div class="column" style="width:40%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>mat_dim <span class="ot">&lt;-</span> </span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="fu">define_transition</span>(</span>
<span id="cb2-3"><a href="#cb2-3"></a>    <span class="at">state_names =</span> </span>
<span id="cb2-4"><a href="#cb2-4"></a>      <span class="fu">c</span>(<span class="st">'A'</span>, <span class="st">'B'</span>, <span class="st">'C'</span>),</span>
<span id="cb2-5"><a href="#cb2-5"></a>   .<span class="dv">3</span>, .<span class="dv">6</span>, .<span class="dv">1</span>, </span>
<span id="cb2-6"><a href="#cb2-6"></a>   .<span class="dv">2</span>, .<span class="dv">5</span>, .<span class="dv">3</span>,</span>
<span id="cb2-7"><a href="#cb2-7"></a>    <span class="dv">0</span>,  <span class="dv">0</span>,  <span class="dv">1</span>)</span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="fu">plot</span>(mat_dim)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="column" style="width:50%;">
<p><span class="math display">\[
\begin{array}{c}\begin{matrix}a &amp; b &amp; c \end{matrix}
\\\left[\
\begin{matrix}
0.3 &amp; 0.6 &amp; 0.1\\
0.2 &amp; 0.5 &amp; 0.3\\
0 &amp; 0 &amp; 1
\end{matrix}\ \right]
\end{array}
\]</span></p>
</div>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="cell-output-display">
<p><img data-src="cohorts_1_files/figure-revealjs/unnamed-chunk-3-1.png" width="576"></p>
</div>
</div>
</div>
</div>
</section>
<section id="absorbing-states" class="slide level2">
<h2>Absorbing states</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<p><img data-src="cohorts_1_files/figure-revealjs/unnamed-chunk-4-1.png" width="384"></p>
</div>
</div>
<p><span class="math display">\[
\begin{array}{c}\begin{matrix}alive &amp; dead \end{matrix}
\\\left[\
\begin{matrix}
0.9 &amp; 0\\
0 &amp; 1
\end{matrix}\ \right]
\end{array}
\]</span></p>
</div><div class="column" style="width:50%;">
<ul>
<li><p>No escape</p></li>
<li><p>Death is common example</p></li>
<li><p>Transition matrix row has a 1 on diagonal entry, all other entries 0</p></li>
</ul>
</div>
</div>
</section>
<section id="tunnel-states" class="slide level2">
<h2>Tunnel states</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<p><img data-src="cohorts_1_files/figure-revealjs/unnamed-chunk-5-1.png" width="384"></p>
</div>
</div>
<p><span class="math display">\[
\begin{array}{c}\begin{matrix}HIV- &amp; Infected &amp; HIV+\end{matrix}
\\\left[\
\begin{matrix}
0.9 &amp; .1 &amp; 0\\
0 &amp; 0 &amp; 1\\
0 &amp; 0 &amp; 1
\end{matrix}\ \right]
\end{array}
\]</span></p>
</div><div class="column" style="width:50%;">
<ul>
<li><p>Temporary state, 1 cycle only</p></li>
<li><p>No self-loop (0 on diagonal)</p></li>
<li><p>A ‘workaround’ for the Markov property.</p></li>
<li><p>If costs, outcomes, or transitions differ for beginning or end of health condition, break into tunnel states</p></li>
</ul>
</div>
</div>
</section>
<section id="example-transfusion-transmitted-chronic-conditions" class="slide level2">
<h2>Example: Transfusion-transmitted chronic conditions</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p><img data-src="ghana_markov_schematics.png"></p>
</div><div class="column" style="width:50%;">
<p>TU=treatment uptake; SC=subclinical; AVT=antiviral therapy; TE=treatment effectiveness; TF=treatment failure; CC=compensated cirrhosis; DCC=decompensated cirrhosis.</p>
<p><a href="www.doi.org/0.1111/trf.16704">Russell et. al.&nbsp;2021</a></p>
</div>
</div>
</section>
<section id="transition-matrix-for-hiv-model" class="slide level2">
<h2>Transition matrix for HIV model</h2>

<img data-src="hiv_transition_matrix.png" class="r-stretch"><p>TU=treatment uptake; OCM=other cause mortality; SC=subclinical; ART=antiviral therapy; TE=treatment effectiveness, NH=natural history. <a href="www.doi.org/0.1111/trf.16704">Russell et. al.&nbsp;2021</a></p>
</section>
<section id="initial-state-vector-m_0" class="slide level2">
<h2>Initial state vector <span class="math inline">\(m_0\)</span></h2>
<ul>
<li><p><span class="math inline">\(1 \times n_s\)</span> vector showing how cohort is distributed at time 0</p></li>
<li><p>Sum of the vector is the total cohort size</p></li>
<li><p>Everyone can be in one state</p>
<p><span class="math display">\[
m_0 =
\begin{bmatrix}
10,000 &amp; 0 &amp; 0 &amp; 0\\
\end{bmatrix}
\]</span></p></li>
<li><p>Or spread across the states</p></li>
</ul>
<p><span class="math display">\[
m_0 =
\begin{bmatrix}
2,000 &amp; 3,000 &amp; 1,000 &amp; 4,000\\
\end{bmatrix}
\]</span></p>
</section>
<section id="rates-and-probabilities" class="slide level2">
<h2>Rates and probabilities</h2>
<ul>
<li><p><strong>Rates</strong> are instintaneous force of an event</p></li>
<li><p><strong>Probabilities</strong> is the cumulative risk over a defined period</p></li>
<li><p>We need: transition probabilities specific to cycle length</p></li>
<li><p>We may have:</p>
<ul>
<li><p>probability for different cycle length (2-year instead of 6 month)</p></li>
<li><p>rate (e.g., 200 events per person-year)</p></li>
</ul></li>
</ul>
</section>
<section id="converting-rates-to-probabilities" class="slide level2">
<h2>Converting rates to probabilities</h2>
<p>Generating an annual probablity <span class="math inline">\(p(t)\)</span> from an event rate <span class="math inline">\(r\)</span> with units events/year:</p>
<p><span class="math display">\[
p(t) = 1 - e^{-rt} \quad r = -\frac{1}{t}log(1-p)
\]</span></p>
<p>Example:</p>
<ul>
<li><p>In a population of 800, 87 became ill over a 2 year period</p></li>
<li><p><span class="math inline">\(r = 87/(2 \times 800) = 0.0544\)</span> illnesses/year</p></li>
<li><p><span class="math inline">\(p_{0.5 year} = 1 - e^{-0.0544(0.5)} = 0.0268\)</span></p></li>
</ul>
</section>
<section id="prob-rate-prob" class="slide level2">
<h2>Prob → rate → prob</h2>
<ul>
<li><p>If probability is for a duration that doesn’t match your cycle length, you <strong>can not</strong> simply multiply/divide the probability</p></li>
<li><p>Instead convert to a rate then convert back to a probability</p></li>
</ul>
<p>Example: The one-year probability of developing cancer is 0.2. If you are building a model with a 1-month cycle length, what probabilty should you use?</p>
<p><span class="math display">\[
p(t) = 1 - e^{-rt} \quad r = -\frac{1}{t}log(1-p)
\]</span></p>
</section>
<section id="prob-rate-prob-1" class="slide level2">
<h2>Prob → rate → prob</h2>
<p>Wrong way</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>p_1yr <span class="ot">=</span> <span class="fl">0.2</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>p_1month <span class="ot">=</span> p_1yr<span class="sc">/</span><span class="dv">12</span>; p_1month</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01666667</code></pre>
</div>
</div>
<p>Right way</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>rate <span class="ot">=</span> <span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">log</span>(<span class="dv">1</span><span class="fl">-0.2</span>)</span>
<span id="cb5-2"><a href="#cb5-2"></a>rate <span class="co">#events/year</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2231436</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a>p_1month <span class="ot">=</span> <span class="dv">1</span> <span class="sc">-</span> <span class="fu">exp</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>rate<span class="sc">/</span><span class="dv">12</span>)</span>
<span id="cb7-2"><a href="#cb7-2"></a>p_1month <span class="co">#probability developing cancer in 1-month period</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.01842347</code></pre>
</div>
</div>
</section>
<section id="today-1" class="slide level2">
<h2>Today</h2>
<ul>
<li><p>Discrete-time cohort state-transition models</p></li>
<li><p><strong>Markov model solution</strong></p></li>
<li><p>Time-varying transitions</p></li>
</ul>
</section>
<section id="matrix-calculations-in-r" class="slide level2">
<h2>Matrix calculations in R</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>A <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb9-2"><a href="#cb9-2"></a>B <span class="ot">=</span> <span class="fu">matrix</span>(<span class="at">data=</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>, <span class="at">nrow=</span><span class="dv">2</span>)</span>
<span id="cb9-3"><a href="#cb9-3"></a>A;B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    1    3
[2,]    2    4</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    5    7
[2,]    6    8</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a><span class="co">#element-wise multiplication</span></span>
<span id="cb12-2"><a href="#cb12-2"></a>A <span class="sc">*</span> B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]    5   21
[2,]   12   32</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a><span class="co">#matrix multiplication</span></span>
<span id="cb14-2"><a href="#cb14-2"></a>A <span class="sc">%*%</span> B</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     [,1] [,2]
[1,]   23   31
[2,]   34   46</code></pre>
</div>
</div>
</section>
<section id="markov-model-components" class="slide level2">
<h2>Markov model components</h2>
<p>Transition matrix</p>
<p><span class="math display">\[
\begin{array}{c}\begin{matrix}Healthy &amp; moderate &amp; severe &amp; dead \end{matrix}
\\\left[\
\begin{matrix}
p_{H \rightarrow H} &amp; p_{H \rightarrow M} &amp; p_{H \rightarrow S} &amp; p_{H \rightarrow D}\\
p_{M \rightarrow H} &amp; p_{M \rightarrow M} &amp; p_{M \rightarrow S} &amp; p_{M \rightarrow D}\\
p_{S \rightarrow H} &amp; p_{S \rightarrow M} &amp; p_{S \rightarrow S} &amp; p_{S \rightarrow D}\\
p_{D \rightarrow H} &amp; p_{D \rightarrow M} &amp; p_{D \rightarrow S} &amp; p_{D \rightarrow D}
\end{matrix}\ \right]
\end{array}
\]</span></p>
<p>initial distribution: <span class="math inline">\(m_0 = \begin{bmatrix} 2000 &amp; 0 &amp; 0 &amp; 0 \end{bmatrix}\)</span></p>
<p>20 cycles, cycle length 1 year</p>
</section>
<section id="parameterizing-the-matrix" class="slide level2">
<h2>Parameterizing the matrix</h2>
<p>Copy/paste and fill in the transition matrix. Use variable names rather than typing the numbers directly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>v_state_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"M"</span>,<span class="st">"S"</span>,<span class="st">"D"</span>) <span class="co">#vector of state names</span></span>
<span id="cb16-2"><a href="#cb16-2"></a></span>
<span id="cb16-3"><a href="#cb16-3"></a>m_0 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">1</span>, <span class="co">#initial dist</span></span>
<span id="cb16-4"><a href="#cb16-4"></a>             <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">""</span>), v_state_names)) </span>
<span id="cb16-5"><a href="#cb16-5"></a></span>
<span id="cb16-6"><a href="#cb16-6"></a>p_HtoM <span class="ot">=</span> <span class="fl">0.2</span> <span class="co">#otherwise stays in healthy</span></span>
<span id="cb16-7"><a href="#cb16-7"></a>p_MtoH <span class="ot">=</span> <span class="fl">0.4</span>; p_MtoS <span class="ot">=</span> <span class="fl">0.4</span>; p_MtoD <span class="ot">=</span> <span class="fl">0.01</span> <span class="co">#otherwise stay in moderate</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>p_StoH <span class="ot">=</span> <span class="fl">0.1</span>; p_StoD <span class="ot">=</span> <span class="fl">0.3</span> <span class="co">#otherwise stay in severe</span></span>
<span id="cb16-9"><a href="#cb16-9"></a></span>
<span id="cb16-10"><a href="#cb16-10"></a>n_cycles <span class="ot">=</span> <span class="dv">20</span></span>
<span id="cb16-11"><a href="#cb16-11"></a></span>
<span id="cb16-12"><a href="#cb16-12"></a>mat_P <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span>
<span id="cb16-13"><a href="#cb16-13"></a>                 <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span>
<span id="cb16-14"><a href="#cb16-14"></a>                 <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>,</span>
<span id="cb16-15"><a href="#cb16-15"></a>                 <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>, <span class="cn">NA</span>),</span>
<span id="cb16-16"><a href="#cb16-16"></a>               <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> T,</span>
<span id="cb16-17"><a href="#cb16-17"></a>               <span class="at">dimnames =</span> <span class="fu">list</span>(v_state_names,</span>
<span id="cb16-18"><a href="#cb16-18"></a>                               v_state_names))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="parameterizing-the-transition-matrix" class="slide level2">
<h2>Parameterizing the transition matrix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>mat_P <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>p_HtoM, p_HtoM,                 <span class="dv">0</span>,                <span class="dv">0</span>,</span>
<span id="cb17-2"><a href="#cb17-2"></a>                 p_MtoH,   <span class="dv">1</span><span class="sc">-</span>p_MtoH<span class="sc">-</span>p_MtoS<span class="sc">-</span>p_MtoD, p_MtoS,          p_MtoD,</span>
<span id="cb17-3"><a href="#cb17-3"></a>                 p_StoH,   <span class="dv">0</span>,                      <span class="dv">1</span><span class="sc">-</span>p_StoH<span class="sc">-</span>p_StoD, p_StoD,</span>
<span id="cb17-4"><a href="#cb17-4"></a>                 <span class="dv">0</span>,        <span class="dv">0</span>,                      <span class="dv">0</span>,                <span class="dv">1</span>), </span>
<span id="cb17-5"><a href="#cb17-5"></a>              <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> T,</span>
<span id="cb17-6"><a href="#cb17-6"></a>              <span class="at">dimnames =</span> <span class="fu">list</span>(v_state_names,</span>
<span id="cb17-7"><a href="#cb17-7"></a>                              v_state_names))</span>
<span id="cb17-8"><a href="#cb17-8"></a>mat_P</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    H    M   S    D
H 0.8 0.20 0.0 0.00
M 0.4 0.19 0.4 0.01
S 0.1 0.00 0.6 0.30
D 0.0 0.00 0.0 1.00</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co">#Check: do all rows sum to 1?</span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="fu">rowSums</span>(mat_P)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>H M S D 
1 1 1 1 </code></pre>
</div>
</div>
</section>
<section id="running-the-model" class="slide level2">
<h2>Running the model</h2>
<p>Definition: <span class="math inline">\(m_t\)</span> is a <span class="math inline">\(1 \times n_s\)</span> matrix with the distribution of the cohort after cycle <span class="math inline">\(t\)</span>. <span class="math inline">\(T\)</span> is our transition probability matrix (dimensions <span class="math inline">\(n_s \times n_s\)</span>).</p>
<p><span class="math display">\[
m_t = m_{t-1} T
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
m^{t-1}_A &amp; m^{t-1}_B\\
\end{bmatrix}
\begin{bmatrix}
p_{A \rightarrow A} &amp; p_{A \rightarrow B}\\
p_{B \rightarrow A} &amp; p_{B \rightarrow B}\\
\end{bmatrix}\\
=\\
\begin{bmatrix}
m^{t-1}_A(p_{A \rightarrow A})+ m^{t-1}_B(p_{B \rightarrow A})&amp;
m^{t-1}_A(p_{A \rightarrow B})+ m^{t-1}_B(p_{B \rightarrow B})\\
\end{bmatrix}
\]</span></p>
</section>
<section id="run-our-model" class="slide level2">
<h2>Run our model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>m_0</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    H M S D
 2000 0 0 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>m_1 <span class="ot">=</span> m_0 <span class="sc">%*%</span> mat_P</span>
<span id="cb23-2"><a href="#cb23-2"></a>m_1</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    H   M S D
 1600 400 0 0</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>m_2 <span class="ot">=</span> m_1 <span class="sc">%*%</span> mat_P</span>
<span id="cb25-2"><a href="#cb25-2"></a>m_2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    H   M   S D
 1440 396 160 4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>m_3 <span class="ot">=</span> m_2 <span class="sc">%*%</span> mat_P</span>
<span id="cb27-2"><a href="#cb27-2"></a>m_3</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      H      M     S     D
 1326.4 363.24 254.4 55.96</code></pre>
</div>
</div>
</section>
<section id="matrix-solution" class="slide level2">
<h2>Matrix solution</h2>
<p>Note the following</p>
<p><span class="math display">\[
\begin{aligned}
&amp; m_1 = m_{0} P\\
&amp; m_{2} = m_{1}P = (m_0P)P = m_0P^2\\
&amp; m_{3} = m_{2} P = (m_0 P^2)P = m_0 P^3\\
\end{aligned}
\]</span></p>
<p>Therefore:</p>
<p><span class="math display">\[
m_t = m_0 P^t
\]</span></p>
</section>
<section id="matrix-solution-code" class="slide level2">
<h2>Matrix solution code</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="co">#m_20 = m_0 %*% (mat_P %^% 20)</span></span>
<span id="cb29-2"><a href="#cb29-2"></a>cycles_to_print <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">10</span>, <span class="dv">20</span>)</span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="cf">for</span> (i <span class="cf">in</span> cycles_to_print){</span>
<span id="cb29-4"><a href="#cb29-4"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"t="</span>,i))</span>
<span id="cb29-5"><a href="#cb29-5"></a>  <span class="fu">print</span>(m_0 <span class="sc">%*%</span> (mat_P <span class="sc">%^%</span> i))</span>
<span id="cb29-6"><a href="#cb29-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "t=2"
    H   M   S D
 1440 396 160 4
[1] "t=10"
        H       M        S        D
 829.5648 221.819 259.3707 689.2455
[1] "t=20"
        H        M       S        D
 439.2979 117.3868 138.721 1304.594</code></pre>
</div>
</div>
</section>
<section id="storing-the-state-transitions" class="slide level2">
<h2>Storing the state transitions</h2>
<p>Matrix <span class="math inline">\(M\)</span> with <span class="math inline">\(n_s\)</span> columns corresponding to our states and <span class="math inline">\(T+1\)</span> rows corresponding to our state distribution after the <span class="math inline">\(0th,1st,…,Tth\)</span> cycles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1"></a>M <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span><span class="sc">*</span><span class="dv">21</span>), <span class="at">ncol=</span><span class="dv">4</span>,</span>
<span id="cb31-2"><a href="#cb31-2"></a>           <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"M"</span>,<span class="st">"S"</span>,<span class="st">"D"</span>)))</span>
<span id="cb31-3"><a href="#cb31-3"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>){</span>
<span id="cb31-4"><a href="#cb31-4"></a>  M[i,] <span class="ot">&lt;-</span> m_0 <span class="sc">%*%</span> (mat_P <span class="sc">%^%</span> (i<span class="dv">-1</span>))</span>
<span id="cb31-5"><a href="#cb31-5"></a>}</span>
<span id="cb31-6"><a href="#cb31-6"></a>M</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           H        M        S         D
0  2000.0000   0.0000   0.0000    0.0000
1  1600.0000 400.0000   0.0000    0.0000
2  1440.0000 396.0000 160.0000    4.0000
3  1326.4000 363.2400 254.4000   55.9600
4  1231.8560 334.2956 297.9360  135.9124
5  1148.9966 309.8874 312.4798  228.6362
6  1074.4002 288.6779 311.4428  325.4790
7  1006.1356 269.7289 302.3369  421.7986
8   943.0337 252.4756 289.2937  515.1970
9   884.3466 236.5771 274.5664  604.5098
10  829.5648 221.8190 259.3707  689.2455
11  778.3165 208.0586 244.3500  769.2749
12  730.3116 195.1944 229.8334  844.6605
13  685.3104 183.1493 215.9778  915.5625
14  643.1058 171.8604 202.8464  982.1873
15  603.5135 161.2746 190.4520 1044.7599
16  566.3658 151.3449 178.7811 1103.5082
17  531.5087 142.0287 167.8066 1158.6560
18  498.7991 133.2872 157.4954 1210.4183
19  468.1037 125.0844 147.8121 1258.9998
20  439.2979 117.3868 138.7210 1304.5942</code></pre>
</div>
</div>
</section>
<section id="markov-trace-diagram" class="slide level2">
<h2>Markov trace diagram</h2>
<p>Line plot of number of people (y-axis) in each health state (x-axis)</p>
<p>Convert <span class="math inline">\(M\)</span> into long-format data table for plotting</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>t_trace <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(M) <span class="co">#convert from matrix</span></span>
<span id="cb33-2"><a href="#cb33-2"></a>t_trace<span class="sc">$</span>Cycle_num <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span> <span class="co">#add col for cycle number</span></span>
<span id="cb33-3"><a href="#cb33-3"></a>t_trace <span class="ot">&lt;-</span> t_trace <span class="sc">|&gt;</span> <span class="co">#Long to wide</span></span>
<span id="cb33-4"><a href="#cb33-4"></a>  <span class="fu">gather</span>(M, <span class="at">key=</span>State, <span class="at">value=</span>Count, H<span class="sc">:</span>D) <span class="co">#wide to long format</span></span>
<span id="cb33-5"><a href="#cb33-5"></a>t_trace</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 84 × 3
   Cycle_num State Count
       &lt;int&gt; &lt;chr&gt; &lt;dbl&gt;
 1         0 M        0 
 2         1 M      400 
 3         2 M      396 
 4         3 M      363.
 5         4 M      334.
 6         5 M      310.
 7         6 M      289.
 8         7 M      270.
 9         8 M      252.
10         9 M      237.
# … with 74 more rows</code></pre>
</div>
</div>
</section>
<section id="markov-trace-diagram-1" class="slide level2">
<h2>Markov trace diagram</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>t_trace, <span class="fu">aes</span>(<span class="at">x=</span>Cycle_num, <span class="at">y=</span>Count, <span class="at">color=</span>State))<span class="sc">+</span></span>
<span id="cb35-2"><a href="#cb35-2"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span><span class="fu">geom_point</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="cohorts_1_files/figure-revealjs/unnamed-chunk-15-1.png" width="960" class="r-stretch"></section>
<section id="today-2" class="slide level2">
<h2>Today</h2>
<ul>
<li><p>Discrete-time cohort state-transition models</p></li>
<li><p>Markov model solution</p></li>
<li><p><strong>Time-varying transitions</strong></p></li>
</ul>
</section>
<section id="limit-of-true-markov-model" class="slide level2">
<h2>Limit of true Markov model</h2>
<p>Matrix solution only works for a pure Markov model</p>
<p>In practice, most multi-year models have transition probabilities that can depend on</p>
<ul>
<li><p><strong>simulation time:</strong> how long the model has been running</p></li>
<li><p><strong>state residence time:</strong> how long someone has been in a state</p></li>
</ul>
</section>
<section id="classic-use-case-for-simulation-time-dependent-probs" class="slide level2">
<h2>Classic use case for simulation time dependent probs</h2>
<ul>
<li><p>Over several years, cohort will die from “other causes” (not the disease modeled)</p></li>
<li><p>Usually approximated with country-specific life tables</p></li>
<li><p><a href="https://www150.statcan.gc.ca/n1/pub/84-537-x/84-537-x2021001-eng.htm">Canadian life tables available from StatsCan</a></p></li>
<li><p>Use “Death probability between age X and X+1”</p></li>
</ul>
</section>
<section id="life-table-data" class="slide level2">
<h2>2020 life table data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>t_other_cause_death <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"prob_death_by_age_2020_StatsCan.csv"</span>,</span>
<span id="cb36-2"><a href="#cb36-2"></a>                                 <span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb36-3"><a href="#cb36-3"></a>t_other_cause_death<span class="sc">$</span>prob_death<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(t_other_cause_death<span class="sc">$</span>prob_death)</span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="fu">ggplot</span>(<span class="at">data=</span>t_other_cause_death, <span class="fu">aes</span>(<span class="at">x=</span>Age, <span class="at">y=</span>prob_death))<span class="sc">+</span></span>
<span id="cb36-5"><a href="#cb36-5"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="cohorts_1_files/figure-revealjs/unnamed-chunk-16-1.png" width="960" class="r-stretch"></section>
<section id="d-transition-array-for-time-dependence" class="slide level2">
<h2>3-D transition array for time dependence</h2>
<p>Transition matrix can be different for each cycle.</p>
<p>Use a 3D array to store:</p>
<ul>
<li><p>Dim 1: “From” health state</p></li>
<li><p>Dim 2: “To” health state</p></li>
<li><p>Dim 3: Correspond to cycle <span class="math inline">\(1,\ldots,t,\ldots,T\)</span></p></li>
</ul>
<p><span class="math inline">\(T[i,j,t]\)</span> is probability of transitioning from state <span class="math inline">\(i\)</span> to state <span class="math inline">\(j\)</span> in cycle <span class="math inline">\(t\)</span></p>
</section>
<section id="one-approach-to-age-specific-other-cause-death" class="slide level2">
<h2>One approach to age-specific other cause death</h2>
<p>Multiply all transitions by <span class="math inline">\((1 - P_{OCM})\)</span> (age-specific probability of other cause mortality), then add <span class="math inline">\(P_{OCM}\)</span> to the probability of transitioning to death.</p>
<p>For <span class="math inline">\(P_{i \rightarrow j}\)</span> for all <span class="math inline">\(i,j \neq Death\)</span>:</p>
<p><span class="math display">\[
P_{i \rightarrow j}^{adjusted} = P_{i \rightarrow j}^{orig}. (1 - P_{OCM})
\]</span></p>
<p>For <span class="math inline">\(P_{i \rightarrow D}\)</span> for all <span class="math inline">\(i \neq Death\)</span>:</p>
<p><span class="math display">\[
P_{i \rightarrow D}^{adjusted} = P_{i \rightarrow D}^{orig}. (1 - P_{OCM})+P_{OCM}
\]</span></p>
</section>
<section id="example-from-moderate-row-of-transition-matrix" class="slide level2">
<h2>Example: ‘from moderate’ row of transition matrix</h2>
<p>Without other cause mortality:</p>
<p><span class="math display">\[
\begin{array}{c}\begin{matrix}H &amp; M &amp; S &amp; D \end{matrix}
\\\left[\
\begin{matrix}
0.40 &amp; 0.19 &amp; 0.40 &amp; 0.01\\
\end{matrix}\ \right]
\end{array}
\]</span></p>
<p>With <span class="math inline">\(P_{OCM}=0.03\)</span>:</p>
<p><span class="math display">\[
\begin{array}{c}\begin{matrix} H &amp; M &amp; S &amp; D \end{matrix}
\\\left[\
\begin{matrix}
0.40(0.97) &amp; 0.19(0.97) &amp; 0.40(0.97) &amp; 0.01(0.97)+0.03\\
\end{matrix}\ \right]
\end{array}
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
0.388 &amp; 0.1843 &amp; 0.388 &amp; 0.0397\\
\end{bmatrix}
\]</span></p>
</section>
<section id="age-specific-death-transition-matrix" class="slide level2">
<h2>Age-specific death: transition matrix</h2>
<p>Cycle length is 1 year, cohort is age 50 at time 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># Pre-allocate 3D transition array</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>arr_P <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>,</span>
<span id="cb37-3"><a href="#cb37-3"></a>              <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">21</span>),</span>
<span id="cb37-4"><a href="#cb37-4"></a>              <span class="at">dimnames=</span><span class="fu">list</span>(v_state_names, v_state_names, <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>))</span>
<span id="cb37-5"><a href="#cb37-5"></a><span class="co">#enter transition matrix</span></span>
<span id="cb37-6"><a href="#cb37-6"></a><span class="cf">for</span>(year <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb37-7"><a href="#cb37-7"></a>  age <span class="ot">=</span> <span class="dv">50</span><span class="sc">+</span>year</span>
<span id="cb37-8"><a href="#cb37-8"></a>  p_OCM <span class="ot">&lt;-</span> t_other_cause_death[t_other_cause_death<span class="sc">$</span>Age<span class="sc">==</span>age,<span class="st">"prob_death"</span>]</span>
<span id="cb37-9"><a href="#cb37-9"></a>  mat_P_this_year <span class="ot">=</span> mat_P<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_OCM)</span>
<span id="cb37-10"><a href="#cb37-10"></a>  mat_P_this_year[,<span class="st">"D"</span>]<span class="ot">&lt;-</span>mat_P_this_year[,<span class="st">"D"</span>]<span class="sc">+</span>p_OCM</span>
<span id="cb37-11"><a href="#cb37-11"></a>  arr_P[ , , year<span class="sc">+</span><span class="dv">1</span>] <span class="ot">&lt;-</span> mat_P_this_year</span>
<span id="cb37-12"><a href="#cb37-12"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="age-specific-death-transition-matrix-1" class="slide level2">
<h2>Age-specific death: transition matrix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1"></a><span class="co">#can inspect our transition array</span></span>
<span id="cb38-2"><a href="#cb38-2"></a>arr_P</span>
<span id="cb38-3"><a href="#cb38-3"></a><span class="co">#Verify that for each cycle, rows of transition matrix sum to 1</span></span>
<span id="cb38-4"><a href="#cb38-4"></a><span class="cf">for</span> (cycle <span class="cf">in</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb38-5"><a href="#cb38-5"></a>  <span class="fu">print</span>(<span class="fu">rowSums</span>(arr_P[ , , cycle<span class="sc">+</span><span class="dv">1</span>]))</span>
<span id="cb38-6"><a href="#cb38-6"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="age-specific-death-m-matrix" class="slide level2">
<h2>Age-specific death: M matrix</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>M_OCM <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span><span class="sc">*</span><span class="dv">21</span>), <span class="at">ncol=</span><span class="dv">4</span>,</span>
<span id="cb39-2"><a href="#cb39-2"></a>           <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"M"</span>,<span class="st">"S"</span>,<span class="st">"D"</span>)))</span>
<span id="cb39-3"><a href="#cb39-3"></a>M_OCM[<span class="dv">1</span>,] <span class="ot">&lt;-</span> m_0 <span class="co">#save initial distribution of cohort</span></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){ <span class="co">#calculate distribution after each cycle</span></span>
<span id="cb39-5"><a href="#cb39-5"></a>  M_OCM[i<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> m_0 <span class="sc">%*%</span> (arr_P[ , , i] <span class="sc">%^%</span> i)</span>
<span id="cb39-6"><a href="#cb39-6"></a>}</span>
<span id="cb39-7"><a href="#cb39-7"></a>M_OCM</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           H         M        S          D
0  2000.0000   0.00000   0.0000    0.00000
1  1595.8240 398.95600   0.0000    5.22000
2  1431.8899 393.76971 159.0989   15.24157
3  1314.3400 359.93731 252.0869   73.63580
4  1215.6758 329.90469 294.0227  160.39682
5  1128.6330 304.39523 306.9418  260.03005
6  1049.6928 282.03934 304.2808  363.98711
7   976.8567 261.87964 293.5388  467.72490
8   909.1029 243.39140 278.8847  568.62098
9   845.5671 226.20297 262.5264  665.70347
10  785.6833 210.08542 245.6508  758.58049
11  729.1871 194.92536 228.9260  846.96152
12  675.8299 180.63279 212.6877  930.84961
13  625.1729 167.07750 197.0253 1010.72433
14  577.2256 154.25494 182.0667 1086.45278
15  531.6225 142.06349 167.7652 1158.54879
16  488.3517 130.49787 154.1549 1226.99552
17  447.1861 119.49618 141.1845 1292.13321
18  408.0078 109.02629 128.8281 1354.13778
19  370.7264  99.06370 117.0635 1413.14641
20  335.3462  89.60936 105.8953 1469.14921</code></pre>
</div>
</div>
</section>
<section id="markov-trace-with-and-without-age-specific-other-cause-mortality" class="slide level2">
<h2>Markov trace with and without age-specific other cause mortality</h2>

<img data-src="cohorts_1_files/figure-revealjs/unnamed-chunk-20-1.png" width="960" class="r-stretch"></section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li><p>Cohort models simulate moving between health states over time</p></li>
<li><p>Markov models have constant transitions allowing matrix solution</p></li>
<li><p>Time-varying transitions solved using 3D transition array</p></li>
</ul>
</section>
<section id="logistics" class="slide level2">
<h2>Logistics</h2>
<ul>
<li>Assignment 1 (cost-effectiveness, decision trees) due Wednesday 1/18</li>
<li>Assignment 2 will be posted by Monday</li>
</ul>
<div class="footer footer-default">

</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="cohorts_1_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="cohorts_1_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="cohorts_1_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="cohorts_1_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="cohorts_1_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="cohorts_1_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="cohorts_1_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="cohorts_1_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="cohorts_1_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="cohorts_1_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'smaller': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const clipboard = new window.ClipboardJS('.code-copy-button', {
        target: function(trigger) {
          return trigger.previousElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      });
      function tippyHover(el, contentFn) {
        const config = {
          allowHTML: true,
          content: contentFn,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto-reveal',
          placement: 'bottom-start'
        };
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          return note.innerHTML;
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>