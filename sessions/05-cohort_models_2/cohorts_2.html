<!DOCTYPE html>
<html lang="en"><head>
<script src="cohorts_2_files/libs/clipboard/clipboard.min.js"></script>
<script src="cohorts_2_files/libs/quarto-html/tabby.min.js"></script>
<script src="cohorts_2_files/libs/quarto-html/popper.min.js"></script>
<script src="cohorts_2_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="cohorts_2_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="cohorts_2_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="cohorts_2_files/libs/quarto-html/quarto-html.min.css" rel="stylesheet" data-mode="light">
<link href="cohorts_2_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.5.47">

  <meta name="author" content="Alton Russell">
  <meta name="dcterms.date" content="2024-09-12">
  <title>Cohort models 2</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="cohorts_2_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="cohorts_2_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="cohorts_2_files/libs/revealjs/dist/theme/quarto.css">
  <link href="cohorts_2_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="cohorts_2_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="cohorts_2_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="cohorts_2_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">

  .callout {
    margin-top: 1em;
    margin-bottom: 1em;  
    border-radius: .25rem;
  }

  .callout.callout-style-simple { 
    padding: 0em 0.5em;
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
    display: flex;
  }

  .callout.callout-style-default {
    border-left: solid #acacac .3rem;
    border-right: solid 1px silver;
    border-top: solid 1px silver;
    border-bottom: solid 1px silver;
  }

  .callout .callout-body-container {
    flex-grow: 1;
  }

  .callout.callout-style-simple .callout-body {
    font-size: 1rem;
    font-weight: 400;
  }

  .callout.callout-style-default .callout-body {
    font-size: 0.9rem;
    font-weight: 400;
  }

  .callout.callout-titled.callout-style-simple .callout-body {
    margin-top: 0.2em;
  }

  .callout:not(.callout-titled) .callout-body {
      display: flex;
  }

  .callout:not(.no-icon).callout-titled.callout-style-simple .callout-content {
    padding-left: 1.6em;
  }

  .callout.callout-titled .callout-header {
    padding-top: 0.2em;
    margin-bottom: -0.2em;
  }

  .callout.callout-titled .callout-title  p {
    margin-top: 0.5em;
    margin-bottom: 0.5em;
  }
    
  .callout.callout-titled.callout-style-simple .callout-content  p {
    margin-top: 0;
  }

  .callout.callout-titled.callout-style-default .callout-content  p {
    margin-top: 0.7em;
  }

  .callout.callout-style-simple div.callout-title {
    border-bottom: none;
    font-size: .9rem;
    font-weight: 600;
    opacity: 75%;
  }

  .callout.callout-style-default  div.callout-title {
    border-bottom: none;
    font-weight: 600;
    opacity: 85%;
    font-size: 0.9rem;
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-default div.callout-content {
    padding-left: 0.5em;
    padding-right: 0.5em;
  }

  .callout.callout-style-simple .callout-icon::before {
    height: 1rem;
    width: 1rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 1rem 1rem;
  }

  .callout.callout-style-default .callout-icon::before {
    height: 0.9rem;
    width: 0.9rem;
    display: inline-block;
    content: "";
    background-repeat: no-repeat;
    background-size: 0.9rem 0.9rem;
  }

  .callout-title {
    display: flex
  }
    
  .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  .callout.no-icon::before {
    display: none !important;
  }

  .callout.callout-titled .callout-body > .callout-content > :last-child {
    padding-bottom: 0.5rem;
    margin-bottom: 0;
  }

  .callout.callout-titled .callout-icon::before {
    margin-top: .5rem;
    padding-right: .5rem;
  }

  .callout:not(.callout-titled) .callout-icon::before {
    margin-top: 1rem;
    padding-right: .5rem;
  }

  /* Callout Types */

  div.callout-note {
    border-left-color: #4582ec !important;
  }

  div.callout-note .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEU0lEQVRYCcVXTWhcVRQ+586kSUMMxkyaElstCto2SIhitS5Ek8xUKV2poatCcVHtUlFQk8mbaaziwpWgglJwVaquitBOfhQXFlqlzSJpFSpIYyXNjBNiTCck7x2/8/LeNDOZxDuEkgOXe++553zfefee+/OYLOXFk3+1LLrRdiO81yNqZ6K9cG0P3MeFaMIQjXssE8Z1JzLO9ls20MBZX7oG8w9GxB0goaPrW5aNMp1yOZIa7Wv6o2ykpLtmAPs/vrG14Z+6d4jpbSKuhdcSyq9wGMPXjonwmESXrriLzFGOdDBLB8Y6MNYBu0dRokSygMA/mrun8MGFN3behm6VVAwg4WR3i6FvYK1T7MHo9BK7ydH+1uurECoouk5MPRyVSBrBHMYwVobG2aOXM07sWrn5qgB60rc6mcwIDJtQrnrEr44kmy+UO9r0u9O5/YbkS9juQckLed3DyW2XV/qWBBB3ptvI8EUY3I9p/67OW+g967TNr3Sotn3IuVlfMLVnsBwH4fsnebJvyGm5GeIUA3jljERmrv49SizPYuq+z7c2H/jlGC+Ghhupn/hcapqmcudB9jwJ/3jvnvu6vu5lVzF1fXyZuZZ7U8nRmVzytvT+H3kilYvH09mLWrQdwFSsFEsxFVs5fK7A0g8gMZjbif4ACpKbjv7gNGaD8bUrlk8x+KRflttr22JEMRUbTUwwDQScyzPgedQHZT0xnx7ujw2jfVfExwYHwOsDTjLdJ2ebmeQIlJ7neo41s/DrsL3kl+W2lWvAga0tR3zueGr6GL78M3ifH0rGXrBC2aAR8uYcIA5gwV8zIE8onoh8u0Fca/ciF7j1uOzEnqcIm59sEXoGc0+z6+H45V1CvAvHcD7THztu669cnp+L0okAeIc6zjbM/24LgGM1gZk7jnRu1aQWoU9sfUOuhrmtaPIO3YY1KLLWZaEO5TKUbMY5zx8W9UJ6elpLwKXbsaZ4EFl7B4bMtDv0iRipKoDQT2sNQI9b1utXFdYisi+wzZ/ri/1m7QfDgEuvgUUEIJPq3DhX/5DWNqIXDOweC2wvIR90Oq3lDpdMIgD2r0dXvGdsEW5H6x6HLRJYU7C69VefO1x8Gde1ZFSJLfWS1jbCnhtOPxmpfv2LXOA2Xk2tvnwKKPFuZ/oRmwBwqRQDcKNeVQkYcOjtWVBuM/JuYw5b6isojIkYxyYAFn5K7ZBF10fea52y8QltAg6jnMqNHFBmGkQ1j+U43HMi2xMar1Nv0zGsf1s8nUsmUtPOOrbFIR8bHFDMB5zL13Gmr/kGlCkUzedTzzmzsaJXhYawnA3UmARpiYj5ooJZiUoxFRtK3X6pgNPv+IZVPcnwbOl6f+aBaO1CNvPW9n9LmCp01nuSaTRF2YxHqZ8DYQT6WsXT+RD6eUztwYLZ8rM+rcPxamv1VQzFUkzFXvkiVrySGQgJNvXHJAxiU3/NwiC03rSf05VBaPtu/Z7/B8Yn/w7eguloAAAAAElFTkSuQmCC');
  }

  div.callout-note.callout-style-default .callout-title {
    background-color: #dae6fb
  }

  div.callout-important {
    border-left-color: #d9534f !important;
  }

  div.callout-important .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAEKklEQVRYCcVXTWhcVRS+575MJym48A+hSRFr00ySRQhURRfd2HYjk2SSTokuBCkU2o0LoSKKraKIBTcuFCoidGFD08nkBzdREbpQ1EDNIv8qSGMFUboImMSZd4/f9zJv8ibJMC8xJQfO3HPPPef7zrvvvnvviIkpC9nsw0UttFunbUhpFzFtarSd6WJkStVMw5xyVqYTvkwfzuf/5FgtkVoB0729j1rjXwThS7Vio+Mo6DNnvLfahoZ+i/o32lULuJ3NNiz7q6+pyAUkJaFF6JwaM2lUJlV0MlnQn5aTRbEu0SEqHUa0A4AdiGuB1kFXRfVyg5d87+Dg4DL6m2TLAub60ilj7A1Ec4odSAc8X95sHh7+ZRPCFo6Fnp7HfU/fBng/hi10CjCnWnJjsxvDNxWw0NfV6Rv5GgP3I3jGWXumdTD/3cbEOP2ZbOZp69yniG3FQ9z1jD7bnBu9Fc2tKGC2q+uAJOQHBDRiZX1x36o7fWBs7J9ownbtO+n0/qWkvW7UPIfc37WgT6ZGR++EOJyeQDSb9UB+DZ1G6DdLDzyS+b/kBCYGsYgJbSQHuThGKRcw5xdeQf8YdNHsc6ePXrlSYMBuSIAFTGAtQo+VuALo4BX83N190NWZWbynBjhOHsmNfFWLeL6v+ynsA58zDvvAC8j5PkbOcXCMg2PZFk3q8MjI7WAG/Dp9AwP7jdGBOOQkAvlFUB+irtm16I1Zw9YBcpGTGXYmk3kQIC/Cds55l+iMI3jqhjAuaoe+am2Jw5GT3Nbz3CkE12NavmzN5+erJW7046n/CH1RO/RVa8lBLozXk9uqykkGAyRXLWlLv5jyp4RFsG5vGVzpDLnIjTWgnRy2Rr+tDKvRc7Y8AyZq10jj8DqXdnIRNtFZb+t/ZRtXcDiVnzpqx8mPcDWxgARUqx0W1QB9MeUZiNrV4qP+Ehc+BpNgATsTX8ozYKL2NtFYAHc84fG7ndxUPr+AR/iQSns7uSUufAymwDOb2+NjK27lEFocm/EE2WpyIy/Hi66MWuMKJn8RvxIcj87IM5Vh9663ziW36kR0HNenXuxmfaD8JC7tfKbrhFr7LiZCrMjrzTeGx+PmkosrkNzW94ObzwocJ7A1HokLolY+AvkTiD/q1H0cN48c5EL8Crkttsa/AXQVDmutfyku0E7jShx49XqV3MFK8IryDhYVbj7Sj2P2eBxwcXoe8T8idsKKPRcnZw1b+slFTubwUwhktrfnAt7J++jwQtLZcm3sr9LQrjRzz6cfMv9aLvgmnAGvpoaGLxM4mAEaLV7iAzQ3oU0IvD5x9ix3yF2RAAuYAOO2f7PEFWCXZ4C9Pb2UsgDeVnFSpbFK7/IWu7TPTvBqzbGdCHOJQSxiEjt6IyZmxQyEJHv6xyQsYk//moVFsN2zP6fRImjfq7/n/wFDguUQFNEwugAAAABJRU5ErkJggg==');
  }

  div.callout-important.callout-style-default .callout-title {
    background-color: #f7dddc
  }

  div.callout-warning {
    border-left-color: #f0ad4e !important;
  }

  div.callout-warning .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAAETklEQVRYCeVWW2gcVRg+58yaTUnizqbipZeX4uWhBEniBaoUX1Ioze52t7sRq6APio9V9MEaoWlVsFasRq0gltaAPuxms8lu0gcviE/FFOstVbSIxgcv6SU7EZqmdc7v9+9mJtNks51NTUH84ed889/PP+cmxP+d5FIbMJmNbpREu4WUkiTtCicKny0l1pIKmBzovF2S+hIJHX8iEu3hZJ5lNZGqyRrGSIQpq15AzF28jgpeY6yk6GVdrfFqdrD6Iw+QlB8g0YS2g7dyQmXM/IDhBhT0UCiRf59lfqmmDvzRt6kByV/m4JjtzuaujMUM2c5Z2d6JdKrRb3K2q6mA+oYVz8JnDdKPmmNthzkAk/lN63sYPgevrguc72aZX/L9C6x09GYyxBgCX4NlvyGUHOKELlm5rXeR1kchuChJt4SSwyddZRXgvwMGvYo4QSlk3/zkHD8UHxwVJA6zjZZqP8v8kK8OWLnIZtLyCAJagYC4rTGW/9Pqj92N/c+LUaAj27movwbi19tk/whRCIE7Q9vyI6yvRpftAKVTdUjOW40X3h5OXsKCdmFcx0xlLJoSuQngnrJe7Kcjm4OMq9FlC7CMmScQANuNvjfP3PjGXDBaUQmbp296S5L4DrpbrHN1T87ZVEZVCzg1FF0Ft+dKrlLukI+/c9ENo+TvlTDbYFvuKPtQ9+l052rXrgKoWkDAFnvh0wTOmYn8R5f4k/jN/fZiCM1tQx9jQQ4ANhqG4hiL0qIFTGViG9DKB7GYzgubnpofgYRwO+DFjh0Zin2m4b/97EDkXkc+f6xYAPX0KK2I/7fUQuwzuwo/L3AkcjugPNixC8cHf0FyPjWlItmLxWw4Ou9YsQCr5fijMGoD/zpdRy95HRysyXA74MWOnscpO4j2y3HAVisw85hX5+AFBRSHt4ShfLFkIMXTqyKFc46xdzQM6XbAi702a7sy04J0+feReMFKp5q9esYLCqAZYw/k14E/xcLLsFElaornTuJB0svMuJINy8xkIYuL+xPAlWRceH6+HX7THJ0djLUom46zREu7tTkxwmf/FdOZ/sh6Q8qvEAiHpm4PJ4a/doJe0gH1t+aHRgCzOvBvJedEK5OFE5jpm4AGP2a8Dxe3gGJ/pAutug9Gp6he92CsSsWBaEcxGx0FHytmIpuqGkOpldqNYQK8cSoXvd+xLxXADw0kf6UkJNFtdo5MOgaLjiQOQHcn+A6h5NuL2s0qsC2LOM75PcF3yr5STuBSAcGG+meA14K/CI21HcS4LBT6tv0QAh8Dr5l93AhZzG5ZJ4VxAqdZUEl9z7WJ4aN+svMvwHHL21UKTd1mqvChH7/Za5xzXBBKrUcB0TQ+Ulgkfbi/H/YT5EptrGzsEK7tR1B7ln9BBwckYfMiuSqklSznIuoIIOM42MQO+QnduCoFCI0bpkzjCjddHPN/F+2Yu+sd9bKNpVwHhbS3LluK/0zgfwD0xYI5dXuzlQAAAABJRU5ErkJggg==');
  }

  div.callout-warning.callout-style-default .callout-title {
    background-color: #fcefdc
  }

  div.callout-tip {
    border-left-color: #02b875 !important;
  }

  div.callout-tip .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAADr0lEQVRYCe1XTWgTQRj9ZjZV8a9SPIkKgj8I1bMHsUWrqYLVg4Ue6v9BwZOxSYsIerFao7UiUryIqJcqgtpimhbBXoSCVxUFe9CTiogUrUp2Pt+3aUI2u5vdNh4dmMzOzHvvezuz8xNFM0mjnbXaNu1MvFWRXkXEyE6aYOYJpdW4IXuA4r0fo8qqSMDBU0v1HJUgVieAXxzCsdE/YJTdFcVIZQNMyhruOMJKXYFoLfIfIvVIMWdsrd+Rpd86ZmyzzjJmLStqRn0v8lzkb4rVIXvnpScOJuAn2ACC65FkPzEdEy4TPWRLJ2h7z4cArXzzaOdKlbOvKKX25Wl00jSnrwVxAg3o4dRxhO13RBSdNvH0xSARv3adTXbBdTf64IWO2vH0LT+cv4GR1DJt+DUItaQogeBX/chhbTBxEiZ6gftlDNXTrvT7co4ub5A6gp9HIcHvzTa46OS5fBeP87Qm0fQkr4FsYgVQ7Qg+ZayaDg9jhg1GkWj8RG6lkeSacrrHgDaxdoBiZPg+NXV/KifMuB6//JmYH4CntVEHy/keA6x4h4CU5oFy8GzrBS18cLJMXcljAKB6INjWsRcuZBWVaS3GDrqB7rdapVIeA+isQ57Eev9eCqzqOa81CY05VLd6SamW2wA2H3SiTbnbSxmzfp7WtKZkqy4mdyAlGx7ennghYf8voqp9cLSgKdqNfa6RdRsAAkPwRuJZNbpByn+RrJi1RXTwdi8RQF6ymDwGMAtZ6TVE+4uoKh+MYkcLsT0Hk8eAienbiGdjJHZTpmNjlbFJNKDVAp2fJlYju6IreQxQ08UJDNYdoLSl6AadO+fFuCQqVMB1NJwPm69T04Wv5WhfcWyfXQB+wXRs1pt+nCknRa0LVzSA/2B+a9+zQJadb7IyyV24YAxKp2Jqs3emZTuNnKxsah+uabKbMk7CbTgJx/zIgQYErIeTKRQ9yD9wxVof5YolPHqaWo7TD6tJlh7jQnK5z2n3+fGdggIOx2kaa2YI9QWarc5Ce1ipNWMKeSG4DysFF52KBmTNMmn5HqCFkwy34rDg05gDwgH3bBi+sgFhN/e8QvRn8kbamCOhgrZ9GJhFDgfcMHzFb6BAtjKpFhzTjwv1KCVuxHvCbsSiEz4CANnj84cwHdFXAbAOJ4LTSAawGWFn5tDhLMYz6nWeU2wJfIhmIJBefcd/A5FWQWGgrWzyORZ3Q6HuV+Jf0Bj+BTX69fm1zWgK7By1YTXchFDORywnfQ7GpzOo6S+qECrsx2ifVQAAAABJRU5ErkJggg==');
  }

  div.callout-tip.callout-style-default .callout-title {
    background-color: #ccf1e3
  }

  div.callout-caution {
    border-left-color: #fd7e14 !important;
  }

  div.callout-caution .callout-icon::before {
    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAAXNSR0IArs4c6QAAAERlWElmTU0AKgAAAAgAAYdpAAQAAAABAAAAGgAAAAAAA6ABAAMAAAABAAEAAKACAAQAAAABAAAAIKADAAQAAAABAAAAIAAAAACshmLzAAACV0lEQVRYCdVWzWoUQRCuqp2ICBLJXgITZL1EfQDBW/bkzUMUD7klD+ATSHBEfAIfQO+iXsWDxJsHL96EHAwhgzlkg8nBg25XWb0zIb0zs9muYYWkoKeru+vn664fBqElyZNuyh167NXJ8Ut8McjbmEraKHkd7uAnAFku+VWdb3reSmRV8PKSLfZ0Gjn3a6Xlcq9YGb6tADjn+lUfTXtVmaZ1KwBIvFI11rRXlWlatwIAAv2asaa9mlB9wwygiDX26qaw1yYPzFXg2N1GgG0FMF8Oj+VIx7E/03lHx8UhvYyNZLN7BwSPgekXXLribw7w5/c8EF+DBK5idvDVYtEEwMeYefjjLAdEyQ3M9nfOkgnPTEkYU+sxMq0BxNR6jExrAI31H1rzvLEfRIdgcv1XEdj6QTQAS2wtstEALLG1yEZ3QhH6oDX7ExBSFEkFINXH98NTrme5IOaaA7kIfiu2L8A3qhH9zRbukdCqdsA98TdElyeMe5BI8Rs2xHRIsoTSSVFfCFCWGPn9XHb4cdobRIWABNf0add9jakDjQJpJ1bTXOJXnnRXHRf+dNL1ZV1MBRCXhMbaHqGI1JkKIL7+i8uffuP6wVQAzO7+qVEbF6NbS0LJureYcWXUUhH66nLR5rYmva+2tjRFtojkM2aD76HEGAD3tPtKM309FJg5j/K682ywcWJ3PASCcycH/22u+Bh7Aa0ehM2Fu4z0SAE81HF9RkB21c5bEn4Dzw+/qNOyXr3DCTQDMBOdhi4nAgiFDGCinIa2owCEChUwD8qzd03PG+qdW/4fDzjUMcE1ZpIAAAAASUVORK5CYII=');
  }

  div.callout-caution.callout-style-default .callout-title {
    background-color: #ffe5d0
  }

  </style>
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Cohort models 2</h1>
  <p class="subtitle">EPIB 676 session 5, McGill University</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Alton Russell 
</div>
</div>
</div>

  <p class="date">2024-09-12</p>
</section>
<section id="packages" class="slide level2">
<h2>Packages</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href=""></a><span class="fu">library</span>(heemod) <span class="co">#health economic markov models</span></span>
<span id="cb1-2"><a href=""></a><span class="fu">library</span>(tidyr) <span class="co">#for spread function for wide-to-long table formating</span></span>
<span id="cb1-3"><a href=""></a><span class="fu">library</span>(ggplot2) <span class="co">#plotting</span></span>
<span id="cb1-4"><a href=""></a><span class="fu">library</span>(expm) <span class="co">#raise matrices to exponents with %^%</span></span>
<span id="cb1-5"><a href=""></a></span>
<span id="cb1-6"><a href=""></a><span class="co">#use install.packages("Package") for any you don't have already</span></span>
<span id="cb1-7"><a href=""></a></span>
<span id="cb1-8"><a href=""></a><span class="fu">theme_set</span>(<span class="fu">theme_bw</span>()) <span class="co">#set ggplot theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="recall-specify-a-discrete-time-cstm" class="slide level2">
<h2>Recall: Specify a discrete time CSTM</h2>
<p>Transition matrix (<span class="math inline">\(n_s \times n_s\)</span>, where <span class="math inline">\(n_s\)</span> is the number of states)</p>
<p><span class="math display">\[
P = \begin{array}{c}\begin{matrix}Healthy &amp; moderate &amp; severe &amp; dead \end{matrix}
\\\left[\
\begin{matrix}
p_{H \rightarrow H} &amp; p_{H \rightarrow M} &amp; p_{H \rightarrow S} &amp; p_{H \rightarrow D}\\
p_{M \rightarrow H} &amp; p_{M \rightarrow M} &amp; p_{M \rightarrow S} &amp; p_{M \rightarrow D}\\
p_{S \rightarrow H} &amp; p_{S \rightarrow M} &amp; p_{S \rightarrow S} &amp; p_{S \rightarrow D}\\
p_{D \rightarrow H} &amp; p_{D \rightarrow M} &amp; p_{D \rightarrow S} &amp; p_{D \rightarrow D}
\end{matrix}\ \right]
\end{array}
\]</span></p>
<p>Initial distribution: <span class="math inline">\(m_0 = \begin{bmatrix} 2000 &amp; 0 &amp; 0 &amp; 0 \end{bmatrix}\)</span></p>
<p>Cycle length: 1 year; Number of cycles: <span class="math inline">\(T=20\)</span></p>
</section>
<section id="recall-run-a-discrete-time-cstm" class="slide level2">
<h2>Recall: Run a discrete time CSTM</h2>
<p>Matrix <span class="math inline">\(M\)</span> stores cohort dist’n after each cycle</p>
<ul>
<li><p><span class="math inline">\(n_s\)</span> columns and <span class="math inline">\(T+1\)</span> rows</p></li>
<li><p>Row <span class="math inline">\(t\)</span> contains <span class="math inline">\(m_t\)</span>, the cohort’s dist’n after cycle <span class="math inline">\(t\)</span></p></li>
</ul>
<p>To calculate rewards (costs or QALYs)</p>
<ul>
<li><p>Specify reward vectors <span class="math inline">\(c,q\)</span> (state rewards only) or reward matrices <span class="math inline">\(C,Q\)</span> (have transition rewards)</p></li>
<li><p>Store in reward matrices <span class="math inline">\(M_c, M_Q\)</span>.</p></li>
<li><p>Apply discount factor to row sums for net present cost/QALY</p></li>
</ul>
</section>
<section id="today" class="slide level2">
<h2>Today</h2>
<ul>
<li><p><strong>Time-varying transitions and rewards</strong></p></li>
<li><p>Time-varying rewards</p></li>
<li><p>Correcting discrete time error</p></li>
<li><p>Capturing epidemiological outcomes</p></li>
<li><p>Differential equation models</p></li>
</ul>
</section>
<section id="limit-of-pure-markov-model" class="slide level2">
<h2>Limit of (pure) Markov model</h2>
<ul>
<li><p>Transition probabilities often depend on</p>
<ul>
<li><p><strong>simulation time:</strong> how long the model has been running</p></li>
<li><p><strong>state residence time:</strong> how long someone has been in a state</p></li>
</ul></li>
<li><p>Not allowed in a (pure) Markov model</p></li>
<li><p><strong>Matrix solution only works for a pure Markov model</strong></p></li>
</ul>
</section>
<section id="common-time-varying-transition" class="slide level2">
<h2>Common time-varying transition</h2>
<ul>
<li><p>Over several years, cohort will die from “other causes” (not the disease modeled)</p></li>
<li><p>Prob. of other cause death changes with age</p></li>
<li><p>Usually approximated with country-specific life tables</p></li>
<li><p><a href="https://www150.statcan.gc.ca/n1/pub/84-537-x/84-537-x2021001-eng.htm">Canadian life tables available from StatsCan</a></p></li>
<li><p>Use column “Death probability between age X and X+1”</p></li>
</ul>
</section>
<section id="life-table-data-for-canada" class="slide level2">
<h2>2020 life table data for Canada</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href=""></a>t_other_cause_death <span class="ot">&lt;-</span> <span class="fu">read.csv2</span>(<span class="st">"prob_death_by_age_2020_StatsCan.csv"</span>,</span>
<span id="cb2-2"><a href=""></a>                                 <span class="at">sep=</span><span class="st">","</span>)</span>
<span id="cb2-3"><a href=""></a>t_other_cause_death<span class="sc">$</span>prob_death<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(t_other_cause_death<span class="sc">$</span>prob_death)</span>
<span id="cb2-4"><a href=""></a><span class="fu">ggplot</span>(<span class="at">data=</span>t_other_cause_death, <span class="fu">aes</span>(<span class="at">x=</span>Age, <span class="at">y=</span>prob_death))<span class="sc">+</span></span>
<span id="cb2-5"><a href=""></a>  <span class="fu">geom_point</span>()<span class="sc">+</span><span class="fu">geom_line</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="cohorts_2_files/figure-revealjs/unnamed-chunk-2-1.png" width="960" class="r-stretch"></section>
<section id="d-transition-arrays" class="slide level2">
<h2>3D transition arrays</h2>
<ul>
<li><p>Use if some transitions differ by cycle</p>
<ul>
<li>E.G., other cause death</li>
</ul></li>
<li><p>A “stack” of transition matrices, one for each cycle</p></li>
<li><p><span class="math inline">\(P[i,j,t]\)</span>: transition prob. from state <span class="math inline">\(i\)</span> to state <span class="math inline">\(j\)</span> in cycle <span class="math inline">\(t\)</span></p>
<ul>
<li><p>Dim 1: “From” health state <span class="math inline">\(1, ..., i, ... I\)</span></p></li>
<li><p>Dim 2: “To” health state <span class="math inline">\(1, ... , j, ... , J\)</span></p></li>
<li><p>Dim 3: during cycle <span class="math inline">\(1,\ldots,t,\ldots,T\)</span></p></li>
</ul></li>
</ul>
</section>
<section id="one-approach-to-age-specific-ocm" class="slide level2">
<h2>One approach to age-specific OCM</h2>
<p>Multiply all transitions by <span class="math inline">\((1 - P_{OCM})\)</span> (age-specific probability of other cause mortality), then add <span class="math inline">\(P_{OCM}\)</span> to the probability of transitioning to death.</p>
<p>For <span class="math inline">\(P_{i \rightarrow j}\)</span> for all <span class="math inline">\(i,j \neq Death\)</span>:</p>
<p><span class="math display">\[
P_{i \rightarrow j}^{adjusted} = P_{i \rightarrow j}^{orig} (1 - P_{OCM})
\]</span></p>
<p>For <span class="math inline">\(P_{i \rightarrow D}\)</span> for all <span class="math inline">\(i \neq Death\)</span>:</p>
<p><span class="math display">\[
P_{i \rightarrow D}^{adjusted} = P_{i \rightarrow D}^{orig} (1 - P_{OCM})+P_{OCM}
\]</span></p>
</section>
<section id="ex-transition-from-moderate" class="slide level2">
<h2>Ex: transition from ‘Moderate’</h2>
<p>Without other cause mortality:</p>
<p><span class="math display">\[
\begin{array}{c}\begin{matrix}H &amp; M &amp; S &amp; D \end{matrix}
\\\left[\
\begin{matrix}
0.40 &amp; 0.19 &amp; 0.40 &amp; 0.01\\
\end{matrix}\ \right]
\end{array}
\]</span></p>
<p>With <span class="math inline">\(P_{OCM}=0.03\)</span>:</p>
<p><span class="math display">\[
\begin{array}{c}\begin{matrix} H &amp; M &amp; S &amp; D \end{matrix}
\\\left[\
\begin{matrix}
0.40(0.97) &amp; 0.19(0.97) &amp; 0.40(0.97) &amp; 0.01(0.97)+0.03\\
\end{matrix}\ \right]
\end{array}
\]</span></p>
<p><span class="math display">\[
\begin{bmatrix}
0.388 &amp; 0.1843 &amp; 0.388 &amp; 0.0397\\
\end{bmatrix}
\]</span></p>
</section>
<section id="ex-model-from-last-class-no-ocm" class="slide level2">
<h2>Ex: model from last class (no OCM)</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href=""></a>v_state_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"M"</span>,<span class="st">"S"</span>,<span class="st">"D"</span>) <span class="co">#vector of state names</span></span>
<span id="cb3-2"><a href=""></a>m_0 <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">2000</span>, <span class="dv">0</span>, <span class="dv">0</span>, <span class="dv">0</span>), <span class="at">nrow =</span> <span class="dv">1</span>, <span class="co">#initial dist</span></span>
<span id="cb3-3"><a href=""></a>             <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">c</span>(<span class="st">""</span>), v_state_names)) </span>
<span id="cb3-4"><a href=""></a>n_cycles <span class="ot">=</span> <span class="dv">20</span>; p_HtoM <span class="ot">=</span> <span class="fl">0.2</span>; p_MtoH <span class="ot">=</span> <span class="fl">0.4</span>; p_MtoS <span class="ot">=</span> <span class="fl">0.4</span>; p_MtoD <span class="ot">=</span> <span class="fl">0.01</span>; p_StoH <span class="ot">=</span> <span class="fl">0.1</span>; p_StoD <span class="ot">=</span> <span class="fl">0.3</span></span>
<span id="cb3-5"><a href=""></a>mat_P <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">c</span>(<span class="dv">1</span><span class="sc">-</span>p_HtoM, p_HtoM,                 <span class="dv">0</span>,                <span class="dv">0</span>,</span>
<span id="cb3-6"><a href=""></a>                 p_MtoH,   <span class="dv">1</span><span class="sc">-</span>p_MtoH<span class="sc">-</span>p_MtoS<span class="sc">-</span>p_MtoD, p_MtoS,          p_MtoD,</span>
<span id="cb3-7"><a href=""></a>                 p_StoH,   <span class="dv">0</span>,                      <span class="dv">1</span><span class="sc">-</span>p_StoH<span class="sc">-</span>p_StoD, p_StoD,</span>
<span id="cb3-8"><a href=""></a>                 <span class="dv">0</span>,        <span class="dv">0</span>,                      <span class="dv">0</span>,                <span class="dv">1</span>), </span>
<span id="cb3-9"><a href=""></a>              <span class="at">nrow =</span> <span class="dv">4</span>, <span class="at">byrow =</span> T,</span>
<span id="cb3-10"><a href=""></a>              <span class="at">dimnames =</span> <span class="fu">list</span>(v_state_names, v_state_names))</span>
<span id="cb3-11"><a href=""></a>M <span class="ot">=</span> <span class="fu">matrix</span>(<span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">4</span><span class="sc">*</span><span class="dv">21</span>), <span class="at">ncol=</span><span class="dv">4</span>,</span>
<span id="cb3-12"><a href=""></a>           <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>, <span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"M"</span>,<span class="st">"S"</span>,<span class="st">"D"</span>)))</span>
<span id="cb3-13"><a href=""></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">21</span>){</span>
<span id="cb3-14"><a href=""></a>  M[i,] <span class="ot">&lt;-</span> m_0 <span class="sc">%*%</span> (mat_P <span class="sc">%^%</span> (i<span class="dv">-1</span>))</span>
<span id="cb3-15"><a href=""></a>}</span>
<span id="cb3-16"><a href=""></a>t_trace <span class="ot">&lt;-</span> <span class="fu">as_tibble</span>(M) <span class="co">#convert from matrix</span></span>
<span id="cb3-17"><a href=""></a>t_trace<span class="sc">$</span>Cycle_num <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">20</span> <span class="co">#add col for cycle number</span></span>
<span id="cb3-18"><a href=""></a>t_trace <span class="ot">&lt;-</span> t_trace <span class="sc">|&gt;</span> <span class="co">#Long to wide</span></span>
<span id="cb3-19"><a href=""></a>  <span class="fu">gather</span>(<span class="at">key=</span>State, <span class="at">value=</span>Count, H<span class="sc">:</span>D) <span class="co">#wide to long format</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="ex-transition-array-with-ocm" class="slide level2">
<h2>Ex: transition array with OCM</h2>
<p>Cycle length is 1 year, cohort is age 50 at time 0.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href=""></a><span class="co"># Pre-allocate 3D transition array</span></span>
<span id="cb4-2"><a href=""></a>arr_P <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">0</span>,</span>
<span id="cb4-3"><a href=""></a>              <span class="at">dim=</span><span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">20</span>),</span>
<span id="cb4-4"><a href=""></a>              <span class="at">dimnames=</span><span class="fu">list</span>(v_state_names, v_state_names, <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>))</span>
<span id="cb4-5"><a href=""></a></span>
<span id="cb4-6"><a href=""></a><span class="co"># Fill in array with transition matrix for each cycle</span></span>
<span id="cb4-7"><a href=""></a><span class="cf">for</span>(cycle <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb4-8"><a href=""></a>  <span class="co">#.  cohort age at start of this cycle</span></span>
<span id="cb4-9"><a href=""></a>  age <span class="ot">=</span> <span class="dv">50</span><span class="sc">+</span>cycle<span class="dv">-1</span></span>
<span id="cb4-10"><a href=""></a>  <span class="co">#.  get prob. other cause mortality from table</span></span>
<span id="cb4-11"><a href=""></a>  p_OCM <span class="ot">&lt;-</span> t_other_cause_death[t_other_cause_death<span class="sc">$</span>Age<span class="sc">==</span>age,<span class="st">"prob_death"</span>]</span>
<span id="cb4-12"><a href=""></a>  <span class="co">#.  Adjust all probs DOWN to "make room" for OCM</span></span>
<span id="cb4-13"><a href=""></a>  mat_P_this_year <span class="ot">=</span> mat_P<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>p_OCM)</span>
<span id="cb4-14"><a href=""></a>  <span class="co">#.  Adjust prob. transitioning to death UP to account for OCM</span></span>
<span id="cb4-15"><a href=""></a>  mat_P_this_year[,<span class="st">"D"</span>]<span class="ot">&lt;-</span>mat_P_this_year[,<span class="st">"D"</span>]<span class="sc">+</span>p_OCM</span>
<span id="cb4-16"><a href=""></a>  <span class="co">#.  Put adjusted transition matrix into the transition array</span></span>
<span id="cb4-17"><a href=""></a>  arr_P[ , , cycle] <span class="ot">&lt;-</span> mat_P_this_year</span>
<span id="cb4-18"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="age-specific-death-t-array" class="slide level2">
<h2>Age-specific death: T array</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href=""></a>arr_P <span class="co"># inspect transition array</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>, , 1

         H         M        S         D
H 0.797912 0.1994780 0.000000 0.0026100
M 0.398956 0.1895041 0.398956 0.0125839
S 0.099739 0.0000000 0.598434 0.3018270
D 0.000000 0.0000000 0.000000 1.0000000

, , 2

         H         M        S         D
H 0.797744 0.1994360 0.000000 0.0028200
M 0.398872 0.1894642 0.398872 0.0127918
S 0.099718 0.0000000 0.598308 0.3019740
D 0.000000 0.0000000 0.000000 1.0000000

, , 3

         H         M        S         D
H 0.797568 0.1993920 0.000000 0.0030400
M 0.398784 0.1894224 0.398784 0.0130096
S 0.099696 0.0000000 0.598176 0.3021280
D 0.000000 0.0000000 0.000000 1.0000000

, , 4

        H        M       S        D
H 0.79736 0.199340 0.00000 0.003300
M 0.39868 0.189373 0.39868 0.013267
S 0.09967 0.000000 0.59802 0.302310
D 0.00000 0.000000 0.00000 1.000000

, , 5

         H         M        S         D
H 0.797144 0.1992860 0.000000 0.0035700
M 0.398572 0.1893217 0.398572 0.0135343
S 0.099643 0.0000000 0.597858 0.3024990
D 0.000000 0.0000000 0.000000 1.0000000

, , 6

         H         M        S         D
H 0.796904 0.1992260 0.000000 0.0038700
M 0.398452 0.1892647 0.398452 0.0138313
S 0.099613 0.0000000 0.597678 0.3027090
D 0.000000 0.0000000 0.000000 1.0000000

, , 7

         H         M        S         D
H 0.796632 0.1991580 0.000000 0.0042100
M 0.398316 0.1892001 0.398316 0.0141679
S 0.099579 0.0000000 0.597474 0.3029470
D 0.000000 0.0000000 0.000000 1.0000000

, , 8

         H         M        S         D
H 0.796344 0.1990860 0.000000 0.0045700
M 0.398172 0.1891317 0.398172 0.0145243
S 0.099543 0.0000000 0.597258 0.3031990
D 0.000000 0.0000000 0.000000 1.0000000

, , 9

         H         M        S         D
H 0.796024 0.1990060 0.000000 0.0049700
M 0.398012 0.1890557 0.398012 0.0149203
S 0.099503 0.0000000 0.597018 0.3034790
D 0.000000 0.0000000 0.000000 1.0000000

, , 10

         H         M        S         D
H 0.795664 0.1989160 0.000000 0.0054200
M 0.397832 0.1889702 0.397832 0.0153658
S 0.099458 0.0000000 0.596748 0.3037940
D 0.000000 0.0000000 0.000000 1.0000000

, , 11

         H         M        S         D
H 0.795272 0.1988180 0.000000 0.0059100
M 0.397636 0.1888771 0.397636 0.0158509
S 0.099409 0.0000000 0.596454 0.3041370
D 0.000000 0.0000000 0.000000 1.0000000

, , 12

         H         M        S         D
H 0.794848 0.1987120 0.000000 0.0064400
M 0.397424 0.1887764 0.397424 0.0163756
S 0.099356 0.0000000 0.596136 0.3045080
D 0.000000 0.0000000 0.000000 1.0000000

, , 13

         H         M        S         D
H 0.794368 0.1985920 0.000000 0.0070400
M 0.397184 0.1886624 0.397184 0.0169696
S 0.099296 0.0000000 0.595776 0.3049280
D 0.000000 0.0000000 0.000000 1.0000000

, , 14

         H         M        S         D
H 0.793848 0.1984620 0.000000 0.0076900
M 0.396924 0.1885389 0.396924 0.0176131
S 0.099231 0.0000000 0.595386 0.3053830
D 0.000000 0.0000000 0.000000 1.0000000

, , 15

         H         M        S         D
H 0.793264 0.1983160 0.000000 0.0084200
M 0.396632 0.1884002 0.396632 0.0183358
S 0.099158 0.0000000 0.594948 0.3058940
D 0.000000 0.0000000 0.000000 1.0000000

, , 16

         H         M        S         D
H 0.792624 0.1981560 0.000000 0.0092200
M 0.396312 0.1882482 0.396312 0.0191278
S 0.099078 0.0000000 0.594468 0.3064540
D 0.000000 0.0000000 0.000000 1.0000000

, , 17

         H         M        S         D
H 0.791912 0.1979780 0.000000 0.0101100
M 0.395956 0.1880791 0.395956 0.0200089
S 0.098989 0.0000000 0.593934 0.3070770
D 0.000000 0.0000000 0.000000 1.0000000

, , 18

        H        M       S        D
H 0.79112 0.197780 0.00000 0.011100
M 0.39556 0.187891 0.39556 0.020989
S 0.09889 0.000000 0.59334 0.307770
D 0.00000 0.000000 0.00000 1.000000

, , 19

        H        M       S        D
H 0.79024 0.197560 0.00000 0.012200
M 0.39512 0.187682 0.39512 0.022078
S 0.09878 0.000000 0.59268 0.308540
D 0.00000 0.000000 0.00000 1.000000

, , 20

         H         M        S         D
H 0.789272 0.1973180 0.000000 0.0134100
M 0.394636 0.1874521 0.394636 0.0232759
S 0.098659 0.0000000 0.591954 0.3093870
D 0.000000 0.0000000 0.000000 1.0000000</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href=""></a><span class="co">#Verify that for each cycle, rows of transition matrix sum to 1</span></span>
<span id="cb7-2"><a href=""></a><span class="cf">for</span> (cycle <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){</span>
<span id="cb7-3"><a href=""></a>  <span class="fu">print</span>(<span class="fu">rowSums</span>(arr_P[ , , cycle]))    }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 
H M S D 
1 1 1 1 </code></pre>
</div>
</div>
</section>
<section id="calculate-m-matrix-with-age-specific-ocm" class="slide level2">
<h2>Calculate M matrix with age-specific OCM</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href=""></a>M_OCM <span class="ot">=</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">ncol=</span><span class="dv">4</span>, <span class="at">nrow =</span> <span class="dv">21</span>,</span>
<span id="cb9-2"><a href=""></a>               <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="fu">paste0</span>(<span class="st">"t"</span>,<span class="dv">0</span><span class="sc">:</span><span class="dv">20</span>), <span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"M"</span>,<span class="st">"S"</span>,<span class="st">"D"</span>)))</span>
<span id="cb9-3"><a href=""></a>M_OCM[<span class="dv">1</span>,] <span class="ot">&lt;-</span> m_0 <span class="co">#save initial distribution of cohort</span></span>
<span id="cb9-4"><a href=""></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>){ <span class="co">#calculate distribution after each cycle</span></span>
<span id="cb9-5"><a href=""></a>  M_OCM[i<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> M_OCM[i,] <span class="sc">%*%</span> arr_P[ , , i]</span>
<span id="cb9-6"><a href=""></a>}</span>
<span id="cb9-7"><a href=""></a>M_OCM</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            H        M        S          D
t0  2000.0000   0.0000   0.0000    0.00000
t1  1595.8240 398.9560   0.0000    5.22000
t2  1432.1914 393.8526 159.1324   14.82359
t3  1315.1970 360.1720 252.2513   72.37966
t4  1217.4208 330.3782 294.4447  157.75631
t5  1131.4785 305.1627 307.7156  255.64316
t6  1053.9249 283.1765 305.5075  357.39107
t7   982.8062 263.4746 295.3265  458.39271
t8   916.9577 245.4943 281.2943  556.25362
t9   855.6197 228.8922 265.6475  649.84068
t10  798.2672 213.4502 249.5852  738.69736
t11  744.5260 199.0257 233.7416  822.70660
t12  694.1063 185.5176 218.4394  901.93671
t13  646.7506 172.8442 203.8256  976.57966
t14  602.2535 160.9433 189.9609 1046.84236
t15  560.4174 149.7582 176.8521 1112.97226
t16  521.0734 139.2418 164.4839 1175.20089
t17  484.0600 129.3495 152.8262 1233.76424
t18  449.2280 120.0410 141.8434 1288.88754
t19  416.4399 111.2790 131.4984 1340.78275
t20  385.5725 103.0306 121.7557 1389.64121</code></pre>
</div>
</div>
</section>
<section id="markov-trace-with-and-without-age-specific-other-cause-mortality" class="slide level2">
<h2>Markov trace with and without age-specific other cause mortality</h2>

<img data-src="cohorts_2_files/figure-revealjs/unnamed-chunk-7-1.png" width="960" class="r-stretch"></section>
<section id="today-1" class="slide level2">
<h2>Today</h2>
<ul>
<li><p>Time-varying transitions and rewards</p></li>
<li><p><strong>Time-varying rewards</strong></p></li>
<li><p>Correcting discrete time error</p></li>
<li><p>Capturing epidemiological outcomes</p></li>
<li><p>Differential equation models</p></li>
</ul>
</section>
<section id="recall-reward-matrices" class="slide level2">
<h2>Recall: reward matrices</h2>
<p><span class="math display">\[
\textbf{C}=
\begin{bmatrix}
c_H &amp; c_M+c_{H \rightarrow M} &amp; c_S+c_{H \rightarrow S} &amp; c_D+c_{H \rightarrow D}\\
c_H+c_{M \rightarrow H} &amp; c_M &amp; c_S+c_{M \rightarrow S} &amp; c_D+c_{M \rightarrow D}\\
c_H+c_{S \rightarrow H} &amp; c_M+c_{S \rightarrow M} &amp; c_S &amp; c_D+c_{S \rightarrow D}\\
c_H+c_{D \rightarrow H} &amp; c_M+c_{D \rightarrow M} &amp; c_S+c_{D \rightarrow S} &amp; c_D
\end{bmatrix},\\
\textbf{Q} =
\begin{bmatrix}
q_H &amp; q_M+q_{H \rightarrow M} &amp; q_S+q_{H \rightarrow S} &amp; q_D+q_{H \rightarrow D}\\
q_H+q_{M \rightarrow H} &amp; q_M &amp; q_S+q_{M \rightarrow S} &amp; q_D+q_{M \rightarrow D}\\
q_H+q_{S \rightarrow H} &amp; q_M+q_{S \rightarrow M} &amp; q_S &amp; q_D+q_{S \rightarrow D}\\
q_H+q_{D \rightarrow H} &amp; q_M+q_{D \rightarrow M} &amp; q_S+q_{D \rightarrow S} &amp; q_D
\end{bmatrix}
\]</span></p>
</section>
<section id="vary-rewards-with-simulation-time" class="slide level2">
<h2>Vary rewards with simulation time</h2>
<ul>
<li><p>Reward <strong><em>matrix</em></strong> assumes costs/QALYs don’t depend on cycle number</p></li>
<li><p>Can use 3D <strong><em>array</em></strong> to assign different rewards by cycle</p>
<ul>
<li><p><span class="math inline">\(\textbf{C}[i,j,t]\)</span> and <span class="math inline">\(\textbf{Q}[i,j,t]\)</span> contain rewards (state + transition) for person going from <span class="math inline">\(i\)</span> to <span class="math inline">\(j\)</span> in cycle <span class="math inline">\(t\)</span></p></li>
<li><p>Can compute total rewards of people who end cycle <span class="math inline">\(t\)</span> in each state:</p>
<ul>
<li><p><span class="math inline">\(\hat{C}_t =m_{t-1} (P \bigodot C[:,:,t])\)</span></p></li>
<li><p><span class="math inline">\(\hat{Q}_t = m_{t-1} (P \bigodot Q[:,:,t])\)</span></p></li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="alternative-2d-matrix-in-loop" class="slide level2">
<h2>Alternative: 2D matrix in-loop</h2>
<p>If you don’t like 3D arrays, instead generate cycle-specific 2D matrices within your for loop</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href=""></a><span class="co">#Pseudocode, won't run without modifications</span></span>
<span id="cb11-2"><a href=""></a>mat_M <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">ncol=</span><span class="dv">4</span>, <span class="at">nrow =</span> n_cycles<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb11-3"><a href=""></a>           <span class="at">dimnames =</span> <span class="fu">list</span>(<span class="dv">0</span><span class="sc">:</span>n_cycles, <span class="fu">c</span>(<span class="st">"H"</span>,<span class="st">"M"</span>,<span class="st">"S"</span>,<span class="st">"D"</span>)))</span>
<span id="cb11-4"><a href=""></a>v_costs_per_cycle <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> ncycles, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb11-5"><a href=""></a>v_QALYs_per_cycle <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">0</span>, <span class="at">nrow =</span> ncycles, <span class="at">ncol=</span><span class="dv">1</span>)</span>
<span id="cb11-6"><a href=""></a></span>
<span id="cb11-7"><a href=""></a>mat_M[<span class="dv">1</span>, ] <span class="ot">&lt;-</span> m_0 <span class="co"># initial distribution</span></span>
<span id="cb11-8"><a href=""></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>n_cycles){</span>
<span id="cb11-9"><a href=""></a>  mat_P_cycle <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co"># Calculate transition matrix for this cycle</span></span>
<span id="cb11-10"><a href=""></a>  mat_C_cycle <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co"># Calculate cost reward matrix for this cycle</span></span>
<span id="cb11-11"><a href=""></a>  mat_Q_cycle <span class="ot">&lt;-</span> <span class="cn">NA</span> <span class="co"># Calculate QALY reward matrix for this cycle</span></span>
<span id="cb11-12"><a href=""></a>  </span>
<span id="cb11-13"><a href=""></a>  M[i<span class="sc">+</span><span class="dv">1</span>,] <span class="ot">&lt;-</span> M[i,] <span class="sc">%*%</span> mat_T_cycle <span class="co">#update cohort distribution</span></span>
<span id="cb11-14"><a href=""></a>  v_costs_per_cycle[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(M[i<span class="sc">+</span><span class="dv">1</span>,] <span class="sc">%*%</span> mat_C_cycle) <span class="co">#calculate costs</span></span>
<span id="cb11-15"><a href=""></a>  v_QALYs_per_cycle[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(M[i<span class="sc">+</span><span class="dv">1</span>,] <span class="sc">%*%</span> mat_Q_cycle) <span class="co">#calculate QALYs</span></span>
<span id="cb11-16"><a href=""></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="today-2" class="slide level2">
<h2>Today</h2>
<ul>
<li><p>Time-varying transitions and reward<strong>s</strong></p></li>
<li><p>Time-varying rewards</p></li>
<li><p><strong>Correcting discrete time error</strong></p></li>
<li><p>Capturing epidemiological outcomes</p></li>
<li><p>Differential equation models</p></li>
</ul>
</section>
<section id="discrete-time-error" class="slide level2">
<h2>Discrete time error</h2>
<ul>
<li><p>In uncorrected models, transitions occur at cycle <u><strong>end</strong></u></p></li>
<li><p>In real life, transitions occur in continuous time</p></li>
<li><p>Transition probs. are cumulative probability of transitioning <u><strong>during</strong></u> a cycle</p></li>
</ul>
</section>
<section id="discrete-time-error-1" class="slide level2">
<h2>Discrete time error</h2>
<p><a href="www.doi.org/10.1177/0272989X13501558"><img data-src="figs/discretation_error_updown.jpeg"></a></p>
<p><a href="https://www.doi.org/10.1177/0272989X13501558">Naimark et. al.&nbsp;2013</a></p>
</section>
<section id="fix-1-shorter-cycle-lengths" class="slide level2">
<h2>Fix 1: Shorter cycle lengths</h2>
<p>As cycle length <span class="math inline">\(\rightarrow\)</span> 0, discretization error <span class="math inline">\(\rightarrow\)</span> 0.</p>
<p><strong>But</strong>, more cycles means more compute needed, and may lead to less interpretable probabilities</p>
<p>Modelers usually use another fix</p>
</section>
<section id="solutions-to-discrete-time-error" class="slide level2">
<h2>Solutions to discrete time error</h2>
<p><a href="https://doi.org/10.1101/2020.07.27.20162651"><img data-src="figs/discretization_corrections.jpg" width="730"></a></p>
<p><a href="https://doi.org/10.1101/2020.07.27.20162651">Srivastava et. al.&nbsp;2020</a></p>
</section>
<section id="simpsons-method" class="slide level2">
<h2>Simpson’s method</h2>
<p>Numerical process to approximate integrating a curve</p>
<p><strong>Simpson’s 1/3rd method</strong> (quadratic approximation; requires even number of cycles):</p>
<ul>
<li><p>Multiply reward by 1/3 for first and last cycle</p></li>
<li><p>In between, multiply by 4/3 for odd cycles and 2/3 for even</p></li>
</ul>
<p><strong>Simpson’s 3/8 method</strong> (cubic approximation; requires that number of cycles are multiple of 3):</p>
<ul>
<li><p>Multiply reward by 3/8 in first and last cycle</p></li>
<li><p>In between, multiply by 6/8 if mult. of 3 and 9/8 otherwise</p></li>
</ul>
</section>
<section id="cycle-tree-approach" class="slide level2">
<h2>Cycle tree approach</h2>
<ul>
<li><p><strong>Intuition:</strong> If individuals make transitions halfway through a cycle on average, they should incur half the cost (QALY) associated with their “from” state and half the cost (QALY) of their “to” state</p></li>
<li><p>Can be implemented similarly to transition rewards in a reward matrix</p></li>
</ul>
<p><span class="math inline">\(\hat{C}_t =m_{t-1} (P \bigodot C)\)</span> or <span class="math inline">\(\hat{Q}_t =m_{t-1} (P \bigodot Q)\)</span> with C and Q as given on next slide</p>
</section>
<section id="cycle-tree-transition-reward-matrices" class="slide level2">
<h2>Cycle tree transition reward matrices</h2>
<p><span class="math display">\[
\textbf{C}=
\begin{bmatrix}
c_H &amp; .5c_H+.5c_M &amp; .5c_H+.5c_S &amp; .5c_H+.5c_D\\
.5c_M+.5c_H &amp; c_M &amp; .5c_M+.5c_S &amp; .5c_M+.5c_D\\
.5c_S+.5c_H &amp; .5c_S+.5c_M &amp; c_S &amp; .5c_S+.5c_D\\
.5c_D+.5c_H &amp; .5c_D+.5c_M &amp; .5c_D+.5c_S &amp; c_D
\end{bmatrix},\\
\textbf{Q} =
\begin{bmatrix}
q_H &amp; .5q_H+.5q_M &amp; .5q_H+.5q_S &amp; .5q_H+.5q_D\\
.5q_M+.5q_H &amp; q_M &amp; .5q_M+.5q_S &amp; .5q_M+.5q_D\\
.5q_S+.5q_H &amp; .5q_S+.5q_M &amp; q_S &amp; .5q_S+.5q_D\\
.5q_D+.5q_H &amp; .5q_D+.5q_M &amp; .5q_D+.5q_S &amp; q_D
\end{bmatrix}
\]</span></p>
</section>
<section id="comparison-of-discrete-time-correction-methods" class="slide level2">
<h2>Comparison of discrete time correction methods</h2>
<p>Simpson rule and cycle tree method both good. I find cycle tree method intuitive (and it doesn’t matter if total number of cycles are a multiple of 2 or 3)</p>

<img data-src="figs/discrete_time_corrections_compare.jpeg" class="r-stretch quarto-figure-center"><p class="caption"><a href="https://doi.org/10.1177/0272989X13501558">Naimark et. al.&nbsp;2013</a></p></section>
<section id="today-3" class="slide level2">
<h2>Today</h2>
<ul>
<li><p><strong>Time-varying transitions and rewards</strong></p></li>
<li><p>Time-varying rewards</p></li>
<li><p>Correcting discrete time error</p></li>
<li><p><strong>Capturing epidemiological outcomes</strong></p></li>
<li><p>Differential equation models</p></li>
</ul>
</section>
<section id="why-capture-epidemiologic-outcomes" class="slide level2">
<h2>Why capture epidemiologic outcomes</h2>
<ul>
<li><p>Measure of intervention effectiveness</p></li>
<li><p>Of interest to decision makers</p></li>
<li><p>Can used to calibrate or validate your model (more later)</p></li>
</ul>
<p><strong>Examples</strong>: survival, prevalence, incidence, lifetime risk</p>
</section>
<section id="survival" class="slide level2">
<h2>Survival</h2>
<ul>
<li><p>Number of people not dead at time <span class="math inline">\(t\)</span></p></li>
<li><p>For each cycle, sum all states (columns of <span class="math inline">\(M\)</span> matrix) except dead</p>
<ul>
<li>Equivalently, cohort size minus number in dead state</li>
</ul></li>
</ul>
</section>
<section id="remaining-life-expectancy" class="slide level2">
<h2>Remaining life expectancy</h2>
<p>Expected number of years before death. Integral of survival:</p>
<p><span class="math display">\[
LE = \int_{t=0}^\infty S(t)
\]</span></p>
<p>In model with discrete time, calculate as:</p>
<p><span class="math display">\[
LE = \Sigma_{t=0}^\infty S(t)
\]</span></p>
<p>Expected age at death = remaining life expectancy + cohorts age at <span class="math inline">\(t=0\)</span>.</p>
</section>
<section id="prevalence" class="slide level2">
<h2>Prevalence</h2>
<ul>
<li><p>Proportion of population alive in a health state at a specific time.</p></li>
<li><p>Calculated as ratio of number in state i over number in any state other than dead</p></li>
<li><p>If multiple model states correspond to health state (e.g., tunnel states), must add them together for the numerator</p></li>
</ul>
</section>
<section id="incidence" class="slide level2">
<h2>Incidence</h2>
<ul>
<li><p>Proportion of population entering health state at <span class="math inline">\(t\)</span></p></li>
<li><p>For a state <span class="math inline">\(j\)</span>:</p>
<ul>
<li><p><span class="math inline">\(m_{t-1} P[:,j]\)</span> is the number entering or staying in state <span class="math inline">\(j\)</span> in cycle <span class="math inline">\(t\)</span></p></li>
<li><p><span class="math inline">\(m_{t-1} P[j,j]\)</span> is the number staying in state <span class="math inline">\(j\)</span> in cycle <span class="math inline">\(t\)</span></p></li>
<li><p><span class="math inline">\(m_{t-1} P[:,j] - m_{t-1} P[j,j]\)</span> is the number entering state <span class="math inline">\(j\)</span> in cycle <span class="math inline">\(t\)</span></p></li>
</ul></li>
<li><p>Divide by number alive at time <span class="math inline">\(t\)</span> to make it a proportion</p></li>
</ul>
</section>
<section id="today-4" class="slide level2">
<h2>Today</h2>
<ul>
<li><p>Time-varying transitions and rewards</p></li>
<li><p>Time-varying rewards</p></li>
<li><p>Correcting discrete time error</p></li>
<li><p>Capturing epidemiological outcomes</p></li>
<li><p><strong>Differential equation models</strong></p></li>
</ul>
</section>
<section id="differential-equation-models" class="slide level2">
<h2>Differential equation models</h2>
<ul>
<li><p>Most common method for <u><strong>continuous time</strong></u> cohort modeling</p></li>
<li><p>Transitions depend on how cohort distributed across states (compartments)</p></li>
<li><p>Very useful for modeling epidemics</p></li>
<li><p>Often approximated with difference equations</p></li>
</ul>
</section>
<section id="differential-equation-models-1" class="slide level2">
<h2>Differential equation models</h2>
<p>Similarities to discrete time CSTMs</p>
<ul>
<li><p>Individual in one state (compartment) at a time</p></li>
<li><p>Individuals in state treated identically</p></li>
<li><p>Transition between states over time</p></li>
</ul>
<p>Differences from discrete time CSTMs</p>
<ul>
<li><p>Continuous time (unless using difference eqn approximation)</p></li>
<li><p>Transition rates can depend how population cohort is distributed across states in that instant</p></li>
</ul>
</section>
<section id="sir-model" class="slide level2">
<h2>SIR model</h2>
<p>Three states: <u><strong>S</strong></u>usceptible, <u><strong>I</strong></u>nfectious, <u><strong>R</strong></u>emoved (recovered or dead)</p>
<p>Infection rate <span class="math inline">\(\beta\)</span> governs S <span class="math inline">\(\rightarrow\)</span> I</p>
<p>Removal rate <span class="math inline">\(\mu\)</span> governs S <span class="math inline">\(\rightarrow\)</span> R</p>

<img data-src="figs/sir_compartments.png" class="r-stretch"></section>
<section id="differential-equations-for-sir" class="slide level2">
<h2>Differential equations for SIR</h2>
<div class="columns">
<div class="column" style="width:40%;">
<p><span class="math display">\[
\begin{aligned}
&amp;\frac{dS}{dt}= -\beta S I\\
&amp;\frac{dI}{dt} = \beta S I - \mu I\\
&amp;\frac{dR}{dt} = \mu I
\end{aligned}
\]</span></p>
</div><div class="column" style="width:60%;">
<p><span class="math display">\[
\begin{aligned}
&amp;S(t+m) = S(t) + \int_t^m -\beta S I dt\\
&amp;I(t+m) = I(t) + \int_t^m (\beta S I - \mu I)dt\\
&amp;R(t+m) = R(t) + \int_t^m \mu I dt
\end{aligned}
\]</span></p>
</div></div>

<img data-src="figs/sir_compartments.png" class="r-stretch"></section>
<section id="sir" class="slide level2">
<h2>SIR</h2>

<img data-src="figs/sir_slide.png" class="r-stretch"></section>
<section id="bigger-r0-means-bigger-and-shorter-epidemic" class="slide level2">
<h2>Bigger R0 means bigger and shorter epidemic</h2>

<img data-src="figs/R0_comparison.png" class="r-stretch"></section>
<section id="difference-equations-a-discrete-approximation" class="slide level2">
<h2>Difference equations: a discrete approximation</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p><span class="math display">\[
\begin{aligned}
&amp;S(t+m) = S(t) + \int_t^m -\beta S I dt\\
&amp;I(t+m) = I(t) + \int_t^m (\beta S I - \mu I)dt\\
&amp;R(t+m) = R(t) + \int_t^m \mu I dt
\end{aligned}
\]</span></p>
</div><div class="column" style="width:40%;">
<p><span class="math display">\[
\begin{aligned}
&amp;S_t = S_{t-1} -\beta^* S_{t-1} I_{t_1}\\
\\
&amp;I_t = I_{t-1} + \beta^* S_{t-1} I_{t-1} - \mu^* I_{t-1}\\
\\
&amp;R_t = R_{t-1} + \mu^* I_{t-1}
\end{aligned}
\]</span></p>
</div></div>
<p><span class="math inline">\(\beta^*\)</span> and <span class="math inline">\(\mu^*\)</span> are discrete analogs for <span class="math inline">\(\beta\)</span> and <span class="math inline">\(\mu\)</span> and their value depends on the cycle length.</p>
</section>
<section id="open-cohorts-models" class="slide level2">
<h2>Open cohorts models</h2>
<ul>
<li><p>While (Semi)Markov models usually closed, differential eqn models can be open</p></li>
<li><p>People enter (born, age in, get condition) and leave (die, age out)</p></li>
<li><p>Cohort size not conserved for open cohorts</p></li>
</ul>

<img data-src="figs/demographic_sir.png" class="r-stretch"></section>
<section id="age-structuring" class="slide level2">
<h2>Age-structuring</h2>
<ul>
<li><p>In (Semi-)Markov models, usually build separate models to capture age cohorts</p></li>
<li><p>For differential eqn model, may need to put age groups in same model for proper transition dynamics</p></li>
</ul>

<img data-src="figs/age_structured_SIR.png" class="r-stretch"></section>
<section id="recap" class="slide level2">
<h2>Recap</h2>
<ul>
<li><p>If transitions or rewards are time-varying, can create 3D arrays and select “slice” for each cycle in a loop</p></li>
<li><p>Cycle tree method corrects discrete time error using a modified transition reward matrix</p></li>
<li><p>Epidemiological measures can be calculated from a cohort model</p></li>
<li><p>Differential (difference) equation models useful when distribution of population across states influences transitions (e.g., infectious diseases)</p></li>
</ul>
</section>
<section id="logistics" class="slide level2">
<h2>Logistics</h2>
<ul>
<li>Assignment 1 (cost-effectiveness, decision trees) due Friday 9/13</li>
<li>Assignment 2 CSTM; due Wednesday 9/25</li>
<li>Next class: workflow for reproducible research</li>
<li>Office hours 1:30 - 2:20pm, room #1103</li>
</ul>
<div class="quarto-auto-generated-content">
<div class="footer footer-default">

</div>
</div>
</section>
    </div>
  </div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="cohorts_2_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="cohorts_2_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="cohorts_2_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="cohorts_2_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="cohorts_2_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="cohorts_2_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="cohorts_2_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="cohorts_2_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="cohorts_2_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="cohorts_2_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        // For code content inside modals, clipBoardJS needs to be initialized with a container option
        // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>